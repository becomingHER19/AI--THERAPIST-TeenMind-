import streamlit as st
import speech_recognition as sr
import pyttsx3
import random

# Set up page
st.set_page_config(page_title="LexiAI", page_icon="ğŸ“˜", layout="centered")

# Custom gradient background using HTML
st.markdown(
    '''
    <style>
    body {
        background: linear-gradient(to bottom, #d2f8d2, #ffffff);
    }
    .stButton>button {
        background-color: #88d498;
        color: white;
        border-radius: 10px;
        padding: 0.5em 1em;
        font-weight: bold;
    }
    </style>
    ''',
    unsafe_allow_html=True
)

st.title("ğŸ“˜ LexiAI â€“ Your Reading Companion")
st.markdown("#### Helping young learners grow with confidence ğŸŒ±")

# Sentence bank by level
sentences = {
    "Beginner": ["The sun is bright today.", "The cat is on the mat."],
    "Intermediate": ["She quickly ran to the store for bread.", "Reading helps us learn new things."],
    "Advanced": ["The curious child explored the possibilities of science.", "Imagination fuels innovation in education."]
}

# Difficulty selection
level = st.selectbox("Choose Reading Level:", ["Beginner", "Intermediate", "Advanced"])
sentence = random.choice(sentences[level])

st.subheader("ğŸ“– Read-Along")
st.markdown(f"**Try reading aloud:** _\"{sentence}\"_")

# Text-to-speech
def speak(text):
    engine = pyttsx3.init()
    engine.say(text)
    engine.runAndWait()

if st.button("ğŸ”Š Hear It"):
    speak(sentence)

# Listen and compare
if st.button("ğŸ¤ Start Reading"):
    r = sr.Recognizer()
    with sr.Microphone() as source:
        st.info("Listening... Speak now!")
        audio = r.listen(source)

    try:
        user_input = r.recognize_google(audio)
        st.success(f"ğŸ—£ï¸ You said: \"{user_input}\"")

        if user_input.lower().strip() == sentence.lower():
            st.balloons()
            speak("Excellent reading! You're amazing.")
            st.success("âœ… Perfect match!")
        else:
            speak("Good effort! Try again.")
            st.warning("â—Almost there. Keep practicing!")

    except sr.UnknownValueError:
        st.error("ğŸ˜¬ Sorry, I didnâ€™t catch that.")
        speak("Sorry, I didnâ€™t catch that. Please try again.")

# Comprehension check (Mock)
st.subheader("ğŸ§  Comprehension Check")
question = "What is bright today?" if sentence == "The sun is bright today." else "What is on the mat?"
options = ["The sun", "The moon", "The mat"] if "bright" in sentence else ["The cat", "The dog", "The bag"]
answer = st.radio("Q: " + question, options)

if st.button("âœ… Submit Answer"):
    correct = "The sun" if "bright" in sentence else "The cat"
    if answer == correct:
        st.success("ğŸ‰ Correct!")
        speak("Great job! Thatâ€™s the right answer.")
    else:
        st.error("âŒ Try again.")
        speak("Oops, not quite. Let's try again.")

# Word buddy
st.subheader("ğŸ’¬ Word Buddy")
word = st.selectbox("Pick a tricky word:", sentence.replace(".", "").split())
word_meanings = {
    "bright": "full of light",
    "sun": "the star at the center of our solar system",
    "cat": "a small domesticated animal",
    "mat": "a piece of fabric for the floor"
}
meaning = word_meanings.get(word.lower(), "Definition not available.")
st.info(f"ğŸ“– Meaning of \"{word}\": {meaning}")
if st.button("ğŸ”Š Hear Word"):
    speak(word)

# Progress tracker (mock stats)
st.subheader("ğŸ“Š Progress Tracker")
st.markdown("**Reading Attempts:** 5  \n**Accuracy:** 80%  \n**Streak:** ğŸ”¥ 3 Days")

st.caption("Made with ğŸ’š by BecomingHER | Prototype version")
